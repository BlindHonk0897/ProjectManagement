<!DOCTYPE html>
<html>
   <head>
      <title>Manager | Projects</title>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
      <link rel="stylesheet" href="/assets/styles/manager_takenProject.css">
   </head>
   <body>
      <!-- <link href="https://fonts.googleapis.com/css?family=Poppins:400,500,600,700" rel="stylesheet"> -->
      <div class="menu"> <span></span> </div>
      <nav id="nav">
         <ul class="main">
            <p style="font-size: 2em; color: #fff;">Manager</p>
            <!-- <li><a href="manager_takenProjects.html" style="color: #ec2652;">Taken Projects</a></li> -->
            <li class="has-subnav">
                  <a class="nav-text" href="manager_takenProjects">Taken Projects</a>
                  <ul>
                     <li><a href="manager_openProjects" class="sub">Open Projects</a></li>
                  </ul>
               </li>
            <!-- <li><a href="manager_openProjects.html">Open Projects</a></li> -->
            <!-- <li><a href="#">Clients</a></li> -->
            <li class="has-subnav">
               <a class="nav-text">Clients</a>
               <ul>
                  <li><a href="manager_assignedClients" class="sub">Assigned Clients</a></li>
                  <li><a href="manager_unassignedClients" class="sub">Unassigned Clients</a></li>
               </ul>
            </li>
            <li><a href="manager_approval">Approval</a></li>
            <li><a href="/">Logout</a></li>
         </ul>
      </nav>
      <div class="overlay"></div>
      <script>
         $('.menu, .overlay').click(function () {
           $('.menu').toggleClass('clicked');
           $('#nav').toggleClass('show');
         });
      </script>
      <div class="container" style="margin-top: 5%; width: 100%;">
         <h3 class="font-weight-normal">Taken Projects</h3>
         <div class="row" style="margin-top: 2%;">
            <table class="table table-borderless table-hover">
               <thead class="thead-dark">
                  <th style="width: 5%;">#</th>
                  <th style="width: 20%;">Project</th>
                  <th style="width: 20%;">Client</th>
                  <th style="width: 15%;">Date Added</th>
                  <th style="width: 10%;">Progress</th>
                  <th style="width: 10%; padding-left: 3%;">Tasks</th>
                  <th style="width: 10%; padding-left: 3%;">Update</th>
               </thead>
               <tbody>
                 <% var counter = 1 %>
                 <% Project.forEach(function(item){%>
                    <tr>
                       <td><%= counter %></td>
                       <td><%= item.ProjectName %></td>
                       <td><%= item.Client %></td>
                       <td><%= item.DateAdded %></td>
                       <td><%= item.Progress+" out of "+item.Tasks.length %></td>
                       <td>
                           <select class="form-control form-control-sm">
                                 <option>View Task</option>
                                 <% item.Tasks.forEach(function(task){%>
                                     <option value="<%= task %>"><%= task %></option>
                                 <%})%>
                           </select>
                       </td>
                       <td><button class="btn btn-sm btn-info" data-id="<%= item.Progress %>" data-a="<%= item.Tasks.length %>" id="<%= item._id %>" style="width: 90%;">Update</button></td>
                    </tr>
                    <% counter++ %>
                 <%})%>
               </tbody>
            </table>
         </div>
      </div>
   </body>
   <script>
   $(document).ready(function(){
     
      $('.btn-info').click(function(){
         //alert($(this).attr('data-a'))
         if($(this).attr('data-id') == $(this).attr('data-a')){
          $('.btn-info').disable();
         }
         if($(this).attr('data-id')< $(this).attr('data-a')){
           var toUp = {
              id:$(this).attr('id'),
           }
            $.ajax({
               method:'POST',
               url:'/updateProgress',
               data:toUp,
               success:function(){
                  top.location.href = "/manager_takenProjects";
               }
            })
         }
         
      })
   })
   </script>
</html>